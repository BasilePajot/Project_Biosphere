# Libraries
# Uncode if needed: install.packages("anyLib")
# This library is used to install the named packages if they are not installed and load them after that or if they are already installed
library(anyLib)
anyLib(c("dbplyr", "tydiverse"))

# First, we retrieve the environment variable that was passed on by the script called "script_concat.sh"
args <- commandArgs()
first <- args[6]

# We make another list to get all the names of the tables to concatenate
orders <- c("Acanaloniidae",
"Acanthocnemidae",
"Acanthopteroctetidae",
"Acanthosomatidae",
"Acartophthalmidae",
"Achilidae",
"Aclerdidae",
"Acroceridae",
"Actinopodidae",
"Adelgidae",
"Adelidae",
"Aderidae",
"Aenictopecheidae",
"Aetalionidae",
"Agaonidae",
"Agathiphagidae",
"Agelenidae",
"Agromyzidae",
"Agyrtidae",
"Aididae",
"Akalyptoischiidae",
"Alexiidae",
"Aleyrodidae",
"Alucitidae",
"Alydidae",
"Amaurobiidae",
"Amblypygi",
"Ammoplanidae",
"Ammoxenidae",
"Amphientomidae",
"Amphipsocidae",
"Amphizoidae",
"Ampulicidae",
"Anamorphidae",
"Anapidae",
"Anaxyelidae",
"Andesianidae",
"Andrenidae",
"Anisopodidae",
"Anthelidae",
"Anthicidae",
"Anthocoridae",
"Anthomyiidae",
"Anthomyzidae",
"Anthribidae",
"Antrodiaetidae",
"Anyphaenidae",
"Apatelodidae",
"Aphalaridae",
"Aphelinidae",
"Aphelocheiridae",
"Aphididae",
"Aphrophoridae",
"Apidae",
"Apioceridae",
"Apsilocephalidae",
"Apystomyiidae",
"Aradidae",
"Araneidae",
"Archaeidae",
"Archaeognatha",
"Archeocrypticidae",
"Archipsocidae",
"Argidae",
"Argyresthiidae",
"Arkyidae",
"Artematopodidae",
"Artheneidae",
"Asilidae",
"Asiopsocidae",
"Aspidytidae",
"Astatidae",
"Asteiidae",
"Asterolecaniidae",
"Atelestidae",
"Athericidae",
"Atracidae",
"Attelabidae",
"Attevidae",
"Atypidae",
"Aulacidae",
"Aulacigastridae",
"Australimyzidae",
"Austrochilidae",
"Austroleptidae",
"Autostichidae",
"Axymyiidae",
"Azotidae",
"Barychelidae",
"Batrachedridae",
"Bedelliidae",
"Belidae",
"Belostomatidae",
"Bembicidae",
"Berytidae",
"Bethylidae",
"Bibionidae",
"Biphyllidae",
"Blasticotomidae",
"Blastobasidae",
"Blattodea",
"Blephariceridae",
"Blissidae",
"Boganiidae",
"Bolbomyiidae",
"Bolitophilidae",
"Bombycidae",
"Bombyliidae",
"Boopiidae",
"Boridae",
"Bostrichidae",
"Bothrideridae",
"Brachodidae",
"Brachystomatidae",
"Braconidae",
"Bradynobaenidae",
"Brahmaeidae",
"Brentidae",
"Bucculatricidae",
"Buprestidae",
"Byrrhidae",
"Byturidae",
"Caeciliusidae",
"Caliscelidae",
"Callidulidae",
"Calliphoridae",
"Callirhipidae",
"Calophyidae",
"Calopsocidae",
"Camillidae",
"Canacidae",
"Canopidae",
"Cantacaderidae",
"Cantharidae",
"Canthyloscelidae",
"Caponiidae",
"Carabidae",
"Caridae",
"Carnidae",
"Carposinidae",
"Carsidaridae",
"Carthaeidae",
"Castniidae",
"Cecidomyiidae",
"Cecidosidae",
"Celyphidae",
"Cephidae",
"Cerambycidae",
"Ceraphronidae",
"Ceratocombidae",
"Ceratopogonidae",
"Cercopidae",
"Cerococcidae",
"Cerophytidae",
"Cerylonidae",
"Chaetosomatidae",
"Chalcididae",
"Chamaemyiidae",
"Chaoboridae",
"Cheiracanthiidae",
"Chelonariidae",
"Chironomidae",
"Chloropidae",
"Choreutidae",
"Chrysididae",
"Chrysolampidae",
"Chrysomelidae",
"Chyphotidae",
"Chyromyidae",
"Cicadellidae",
"Cicadidae",
"Ciidae",
"Cimberididae",
"Cimbicidae",
"Cimeliidae",
"Cimicidae",
"Cithaeronidae",
"Cixiidae",
"Cladiopsocidae",
"Clambidae",
"Clastopteridae",
"Cleridae",
"Clubionidae",
"Clusiidae",
"Coccidae",
"Coccinellidae",
"Coelopidae",
"Coelostomidiidae",
"Coleophoridae",
"Colletidae",
"Colobathristidae",
"Compsocidae",
"Conchaspididae",
"Conopidae",
"Copromorphidae",
"Coreidae",
"Corethrellidae",
"Corinnidae",
"Corixidae",
"Corylophidae",
"Cosmopterigidae",
"Cossidae",
"Crabronidae",
"Crambidae",
"Cryptochetidae",
"Cryptococcidae",
"Cryptophagidae",
"Ctenidae",
"Ctenizidae",
"Ctenostylidae",
"Cucujidae",
"Culicidae",
"Cupedidae",
"Curculionidae",
"Curtonotidae",
"Cyatholipidae",
"Cybaeidae",
"Cybocephalidae",
"Cyclaxyridae",
"Cycloctenidae",
"Cyclotornidae",
"Cydnidae",
"Cylindrotomidae",
"Cymidae",
"Cynipidae",
"Cypselosomatidae",
"Cyrtaucheniidae",
"Cyrtocoridae",
"Dactylopiidae",
"Dalceridae",
"Dascillidae",
"Dasydemellidae",
"Deinopidae",
"Delphacidae",
"Depressariidae",
"Derbidae",
"Dermaptera",
"Dermestidae",
"Derodontidae",
"Desidae",
"Deuterophlebiidae",
"Diadocidiidae",
"Diapriidae",
"Diaspididae",
"Diastatidae",
"Dictynidae",
"Dictyopharidae",
"Diguetidae",
"Dinidoridae",
"Diopsidae",
"Dipluridae",
"Diprionidae",
"Dipsocoridae",
"Diptera_family_incertae_sedis",
"Discolomatidae",
"Disteniidae",
"Ditomyiidae",
"Dixidae",
"Doidae",
"Dolabellopsocidae",
"Dolichopodidae",
"Douglasiidae",
"Drepanidae",
"Drosophilidae",
"Dryadaulidae",
"Dryinidae",
"Drymusidae",
"Dryomyzidae",
"Dryopidae",
"Dudgeoneidae",
"Dysderidae",
"Dytiscidae",
"Echinophthiriidae",
"Ectopsocidae",
"Elachistidae",
"Elateridae",
"Elipsocidae",
"Elmidae",
"Embioptera",
"Embolemidae",
"Empididae",
"Encyrtidae",
"Endomychidae",
"Endromidae",
"Enicocephalidae",
"Epermeniidae",
"Ephemeroptera",
"Ephydridae",
"Epicopeiidae",
"Epimetopidae",
"Epipsocidae",
"Epipygidae",
"Epipyropidae",
"Erebidae",
"Eresidae",
"Eriaporidae",
"Eriococcidae",
"Eriocottidae",
"Eriocraniidae",
"Erotylidae",
"Eucharitidae",
"Eucinetidae",
"Eucnemidae",
"Euctenizidae",
"Eulichadidae",
"Eulophidae",
"Eupelmidae",
"Eupsilobiidae",
"Eupterotidae",
"Eurybrachidae",
"Eurytomidae",
"Euteliidae",
"Eutrichosomatidae",
"Euxestidae",
"Evaniidae",
"Evocoidae",
"Fanniidae",
"Fergusoninidae",
"Figitidae",
"Filistatidae",
"Flatidae",
"Formicidae",
"Fulgoridae",
"Galacticidae",
"Gallieniellidae",
"Gasteruptiidae",
"Gelastocoridae",
"Gelechiidae",
"Geocoridae",
"Geometridae",
"Georissidae",
"Geotrupidae",
"Gerridae",
"Glaphyridae",
"Glaresidae",
"Glossinidae",
"Glyphipterigidae",
"Gnaphosidae",
"Gobryidae",
"Gracillariidae",
"Gradungulidae",
"Gyrinidae",
"Haematomyzidae",
"Haematopinidae",
"Hahniidae",
"Halictidae",
"Haliplidae",
"Halonoproctidae",
"Hebridae",
"Hedylidae",
"Helcomyzidae",
"Heleomyzidae",
"Heliodinidae",
"Heliozelidae",
"Helophoridae",
"Heloridae",
"Helosciomyzidae",
"Helotidae",
"Helotrephidae",
"Hemipsocidae",
"Hepialidae",
"Heptamelidae",
"Hermatobatidae",
"Hersiliidae",
"Hesperiidae",
"Hesperinidae",
"Heterobathmiidae",
"Heteroceridae",
"Heterogastridae",
"Heterogynidae",
"Hexathelidae",
"Hilarimorphidae",
"Himantopteridae",
"Hippoboscidae",
"Histeridae",
"Hobartiidae",
"holothyrida",
"Homalocnemiidae",
"Homalonychidae",
"Homotomidae",
"Hoplopleuridae",
"Huttoniidae",
"Huttoninidae",
"Hyblaeidae",
"Hybosoridae",
"Hybotidae",
"Hydraenidae",
"Hydrochidae",
"Hydrometridae",
"Hydrophilidae",
"Hydroscaphidae",
"Hygrobiidae",
"Hypochilidae",
"Ibaliidae",
"Iberobaeniidae",
"Ichneumonidae",
"Idiopidae",
"Idiostolidae",
"Immidae",
"Inbiomyiidae",
"Incurvariidae",
"Ironomyiidae",
"Ischaliidae",
"Ismaridae",
"Issidae",
"Iteaphila-group",
"Ixodida",
"Joppeicidae",
"Jurasaidae",
"Kateretidae",
"Kermesidae",
"Keroplatidae",
"Kerriidae",
"Kinnaridae",
"Kuwaniidae",
"Lachesillidae",
"Lacturidae",
"Laemobothriidae",
"Laemophloeidae",
"Lamponidae",
"Lampyridae",
"Largidae",
"Lasiocampidae",
"Lasiochilidae",
"Latridiidae",
"Lauxaniidae",
"Lecithoceridae",
"Leiodidae",
"Lepiceridae",
"Lepidopsocidae",
"Lepidoptera_incertae_sedis",
"Leptonetidae",
"Leptopodidae",
"Lestoniidae",
"Leucospidae",
"Limacodidae",
"Limnichidae",
"Limoniidae",
"Linognathidae",
"Linyphiidae",
"Liocranidae",
"Liopteridae",
"Liphistiidae",
"Liposcelididae",
"Liviidae",
"Lonchaeidae",
"Lonchopteridae",
"Lophocateridae",
"Lophocoronidae",
"Lophopidae",
"Lucanidae",
"Lutrochidae",
"Lycaenidae",
"Lycidae",
"Lycosidae",
"Lyctocoridae",
"Lygaeidae",
"Lymexylidae",
"Lyonetiidae",
"Lypusidae",
"Maamingidae",
"Machaerotidae",
"Macrothelidae",
"Macroveliidae",
"Malcidae",
"Malkaridae",
"Mantodea",
"Marchalinidae",
"Margarodidae",
"Marginidae",
"Mauroniscidae",
"Mecoptera",
"Mecysmaucheniidae",
"Meenoplidae",
"Meessiidae",
"Megachilidae",
"Megadictynidae",
"Megalodontesidae",
"Megalopodidae",
"Megaloptera",
"Megalopygidae",
"Megalyridae",
"Megamerinidae",
"Megarididae",
"Megaspilidae",
"Megastigmidae",
"Melandryidae",
"Melittidae",
"Mellinidae",
"Meloidae",
"Melyridae",
"Membracidae",
"Menoponidae",
"Meruidae",
"Mesembrinellidae",
"Mesopsocidae",
"Mesostigmata",
"Mesoveliidae",
"Metarbelidae",
"Micromalthidae",
"Micropezidae",
"Microphysidae",
"Micropterigidae",
"Microthoraciidae",
"Migidae",
"Milichiidae",
"Millieriidae",
"Mimallonidae",
"Mimetidae",
"Miridae",
"Miturgidae",
"Mnesarchaeidae",
"Momphidae",
"Monomachidae",
"Monophlebidae",
"Monotomidae",
"Mordellidae",
"Murmidiidae",
"Musapsocidae",
"Muscidae",
"Mutillidae",
"Mycetaeidae",
"Mycetophagidae",
"Mycetophilidae",
"Mycteridae",
"Mydidae",
"Mymaridae",
"Mymarommatidae",
"Myopsocidae",
"Myraboliidae",
"Myrmecicultoridae",
"Myrmosidae",
"Mysmenidae",
"Mystacinobiidae",
"Nabidae",
"Nannodastiidae",
"Naucoridae",
"Nemesiidae",
"Nemestrinidae",
"Nemonychidae",
"Neopseustidae",
"Nepidae",
"Nepticulidae",
"Neriidae",
"Nesticidae",
"Neuroptera",
"Nicodamidae",
"Ninidae",
"Nitidulidae",
"Noctuidae",
"Nogodinidae",
"Nolidae",
"Nosodendridae",
"Noteridae",
"Nothybidae",
"Notodontidae",
"Notonectidae",
"Notoptera",
"Nymphalidae",
"Nymphomyiidae",
"Ochodaeidae",
"Ochteridae",
"Ochyroceratidae",
"Odiniidae",
"Odonata",
"Oecobiidae",
"Oecophoridae",
"Oedemeridae",
"Oenosandridae",
"Oestridae",
"Omethidae",
"Ommatidae",
"Oonopidae",
"Opetiidae",
"Opilioacarida",
"Opiliones",
"Opomyzidae",
"Opostegidae",
"Oreogetonidae",
"Ormyridae",
"Orsodacnidae",
"Orsolobidae",
"Ortheziidae",
"Orthoptera",
"Orussidae",
"Oxycarenidae",
"Oxyopidae",
"Oxypeltidae",
"Pachygronthidae",
"Pachyneuridae",
"Pachytroctidae",
"Pacullidae",
"Palaephatidae",
"Pallopteridae",
"Palpigradi",
"Palpimanidae",
"Pamphiliidae",
"Pantophthalmidae",
"Papilionidae",
"Paracaeciliidae",
"Paraleucopidae",
"Paraphrynoveliidae",
"Parastrachiidae",
"Paratropididae",
"Passalidae",
"Passandridae",
"Pediciidae",
"Pedicinidae",
"Pediculidae",
"Pelecinidae",
"Pelecorhynchidae",
"Peloridiidae",
"Peltidae",
"Pemphredonidae",
"Penestomidae",
"Pentatomidae",
"Pergidae",
"Periegopidae",
"Perilampidae",
"Peripsocidae",
"Periscelididae",
"Phacopteronidae",
"Phalacridae",
"Phasmatodea",
"Phaudidae",
"Phengodidae",
"Phiditiidae",
"Philanthidae",
"Philodromidae",
"Philopteridae",
"Philotarsidae",
"Phloeidae",
"Phloeostichidae",
"Phloiophilidae",
"Pholcidae",
"Phoridae",
"Phrurolithidae",
"Phycosecidae",
"Phylloxeridae",
"Physoglenidae",
"Phyxelididae",
"Pieridae",
"Piesmatidae",
"Pimoidae",
"Piophilidae",
"Pipunculidae",
"Pisauridae",
"Plataspidae",
"Platygastridae",
"Platypezidae",
"Platystomatidae",
"Plecoptera",
"Plectreuridae",
"Pleidae",
"Plokiophilidae",
"Plumariidae",
"Plutellidae",
"Polleniidae",
"Polyctenidae",
"Polyplacidae",
"Pompilidae",
"Porrhothelidae",
"Potamocoridae",
"Praydidae",
"Priasilphidae",
"Prionoceridae",
"Prionoglarididae",
"Proctotrupidae",
"Prodidactidae",
"Prodidomidae",
"Prodoxidae",
"Promecheilidae",
"Prostomidae",
"Protocucujidae",
"Psechridae",
"Psenidae",
"Psephenidae",
"Pseudobistonidae",
"Pseudocaeciliidae",
"Pseudococcidae",
"Pseudopomyzidae",
"Psilidae",
"Psilodercidae",
"Psilopsocidae",
"Psocidae",
"Psoquillidae",
"Psychidae",
"Psychodidae",
"Psyllidae",
"Psyllipsocidae",
"Pterolonchidae",
"Pteromalidae",
"Pterophoridae",
"Pthiridae",
"Ptiliidae",
"Ptilodactylidae",
"Ptiloneuridae",
"Ptinidae",
"Ptychopteridae",
"Putoidae",
"Pyralidae",
"Pyrgotidae",
"Pyrochroidae",
"Pyrrhocoridae",
"Pythidae",
"Raphidioptera",
"Ratardidae",
"Reduviidae",
"Rentoniidae",
"Rhadalidae",
"Rhagionidae",
"Rhagophthalmidae",
"Rhipiceridae",
"Rhizoecidae",
"Rhopalidae",
"Rhopalosomatidae",
"Rhyparochromidae",
"Rhysodidae",
"Ricaniidae",
"Richardiidae",
"Ricinidae",
"Riodinidae",
"Ripiphoridae",
"Roeslerstammiidae",
"Ropalomeridae",
"Roproniidae",
"Rotoitidae",
"Saldidae",
"Salpingidae",
"Salticidae",
"Sapygidae",
"Sarcophagidae",
"Sarcoptiformes",
"Saturniidae",
"Scarabaeidae",
"Scathophagidae",
"Scatopsidae",
"Scelionidae",
"Scenopinidae",
"Schistonoeidae",
"Schizomida",
"Schizopodidae",
"Schizopteridae",
"Schreckensteiniidae",
"Sciaridae",
"Sciaroidea_incertae_sedis",
"Sciomyzidae",
"Scirtidae",
"Sclerogibbidae",
"Scolebythidae",
"Scoliidae",
"Scorpiones",
"Scraptiidae",
"Scutelleridae",
"Scythrididae",
"Scythropiidae",
"Scytodidae",
"Segestriidae",
"Selenopidae",
"Sematuridae",
"Senoculidae",
"Sepsidae",
"Sesiidae",
"Sicariidae",
"Sierolomorphidae",
"Signiphoridae",
"Silphidae",
"Silvanidae",
"Simaethistidae",
"Simuliidae",
"Siphonaptera",
"Siricidae",
"Smicripidae",
"Solifugae",
"Somabrachyidae",
"Somatiidae",
"Sparasionidae",
"Sparassidae",
"Spercheidae",
"Sphaeritidae",
"Sphaeriusidae",
"Sphaeroceridae",
"Sphecidae",
"Sphindidae",
"Sphingidae",
"Staphylinidae",
"Stathmopodidae",
"Stenocephalidae",
"Stenochilidae",
"Stenopsocidae",
"Stenotrachelidae",
"Stenotritidae",
"Stephanidae",
"Stictococcidae",
"Stiphidiidae",
"Stratiomyidae",
"Strepsiptera",
"Strongylophthalmyiidae",
"Symphytognathidae",
"Synaphridae",
"Synchroidae",
"Synotaxidae",
"Syringogastridae",
"Syrphidae",
"Tabanidae",
"Tachinidae",
"Tanaostigmatidae",
"Tanyderidae",
"Tanypezidae",
"Telemidae",
"Tenebrionidae",
"Tenebrionoidea_incertae_sedis",
"Tenthredinidae",
"Tephritidae",
"Termitaphididae",
"Tessaratomidae",
"Tetrablemmidae",
"Tetracampidae",
"Tetragnathidae",
"Tetratomidae",
"Tettigarctidae",
"Tettigometridae",
"Thanerocleridae",
"Thaumaleidae",
"Thaumastellidae",
"Thaumastocoridae",
"Theraphosidae",
"Therevidae",
"Theridiidae",
"Theridiosomatidae",
"Thomisidae",
"Throscidae",
"Thymalidae",
"Thynnidae",
"Thyreocoridae",
"Thyrididae",
"Thysanoptera",
"Tineidae",
"Tineodidae",
"Tingidae",
"Tiphiidae",
"Tipulidae",
"Tischeriidae",
"Titanoecidae",
"Tonzidae",
"Torridincolidae",
"Tortricidae",
"Torymidae",
"Toxopidae",
"Trachelidae",
"Trachypachidae",
"Trachypetidae",
"Trechaleidae",
"Trichoceridae",
"Trichodectidae",
"Trichogrammatidae",
"Trichopsocidae",
"Trichoptera",
"Trictenotomidae",
"Tridentaformidae",
"Trigonalidae",
"Triozidae",
"Trochanteriidae",
"Troctopsocidae",
"Trogidae",
"Trogiidae",
"Trogloraptoridae",
"Trogossitidae",
"Trombidiformes",
"Tropiduchidae",
"Udubidae",
"Ulidiidae",
"Uloboridae",
"Ulodidae",
"Uraniidae",
"Urodidae",
"Uropygi",
"Urostylididae",
"Ustyurtiidae",
"Vanhorniidae",
"Veliidae",
"Velocipedidae",
"Vermileonidae",
"Vesperidae",
"Vespidae",
"Viridasiidae",
"Xenoctenidae",
"Xiphydriidae",
"Xyelidae",
"Xylomyidae",
"Xylophagidae",
"Xyloryctidae",
"Yponomeutidae",
"Ypsolophidae",
"Zodariidae",
"Zopheridae",
"Zoraptera",
"Zoropsidae",
"Zygaenidae",
"Zygentoma")

# Here, we make a loop that will go through the list, extract the name of the taxa, get the file corresponding to the taxa and adding this file to the already existing list of concatenated tables.
for (i in seq_along(orders)) {
    # First extracting the name of the ith element of the list
    order <- orders[i]
    print(order)

    # Making a filename variable to know which table to get in the "Orders" directory.
    filename <- paste0(
        "/lustre/pajotb/blasting_data/database/Orders/Order_",
        order,
        ".csv")

    # Importing the good table using the filename variable
    file_to_add <- as.data.frame(
        read.csv(file = filename,
        sep = ";",
        header = TRUE,
        stringsAsFactors = TRUE)
        )

    # Separing two scenari: the case where there is no table created before and where the "first" variable will be used as a comparison element and the case where there is already an existing database and we bind the two
    if (order == first) {
        global <- file_to_add
    }else {
        global <- rbind(global, file_to_add)
    }

    # Printing the number of rows of the global database (concatenation of the tables) at each round to see if it is really growing or not
    print(nrow(global))
    print("ok")
}

# Exporting the final database when all the concatenation processes have been done
write.table(global,
    "Bold.csv",
    na = "NA",
    sep = ";",
    row.names = FALSE,
    col.names = TRUE)

print("finished")
